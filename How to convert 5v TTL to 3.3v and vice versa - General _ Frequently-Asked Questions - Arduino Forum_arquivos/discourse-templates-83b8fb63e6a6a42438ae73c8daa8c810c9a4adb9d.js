define("discourse/plugins/discourse-templates/discourse/components/d-templates/filterable-list",["exports","@ember/component","@glimmer/component","@glimmer/tracking","@ember/object","@ember/runloop","@ember/service","discourse/lib/ajax","discourse/lib/ajax-error","discourse-common/utils/decorators","select-kit/components/tag-drop","@ember/template-factory"],(function(e,t,i,r,o,l,a,s,n,c,u,p){"use strict"
var d,m,b,f,h,g,v,y
function _(e,t,i,r){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function w(e,t,i,r,o){var l={}
return Object.keys(r).forEach((function(e){l[e]=r[e]})),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=i.slice().reverse().reduce((function(i,r){return r(e,t,i)||i}),l),o&&void 0!==l.initializer&&(l.value=l.initializer?l.initializer.call(o):void 0,l.initializer=void 0),void 0===l.initializer&&(Object.defineProperty(e,t,l),l=null),l}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const T=(0,p.createTemplateFactory)({id:"MxdRx2Ru",block:'[[[11,0],[24,0,"templates-filterable-list"],[4,[38,0],[[30,0,["load"]]],null],[12],[1,"\\n\\n  "],[8,[39,1],null,[["@condition"],[[30,0,["loading"]]]],[["default"],[[[[1,"\\n    "],[10,0],[14,0,"templates-filter-bar"],[12],[1,"\\n"],[41,[30,0,["siteSettings","tagging_enabled"]],[[[1,"        "],[8,[39,3],null,[["@availableTags","@tagId","@onChangeSelectedTag"],[[30,0,["availableTags"]],[30,0,["selectedTag"]],[30,0,["changeSelectedTag"]]]],null],[1,"\\n"]],[]],null],[1,"      "],[8,[39,4],[[24,0,"templates-filter"],[16,"placeholder",[28,[37,5],["templates.filter_hint"],null]]],[["@value"],[[30,0,["listFilter"]]]],null],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"templates-list"],[12],[1,"\\n"],[42,[28,[37,7],[[28,[37,7],[[30,0,["filteredReplies"]]],null]],null],null,[[[1,"        "],[8,[39,8],null,[["@template","@model","@onInsertTemplate"],[[30,1],[30,2],[30,0,["insertTemplate"]]]],null],[1,"\\n"]],[1]],null],[1,"    "],[13],[1,"\\n  "]],[]]]]],[1,"\\n"],[13]],["r","@model"],false,["did-insert","conditional-loading-spinner","if","d-templates/tag-drop","text-field","i18n","each","-track-array","d-templates/item"]]',moduleName:"discourse/plugins/discourse-templates/discourse/components/d-templates/filterable-list.hbs",isStrictMode:!1})
let O=e.default=(d=(0,o.computed)("replies","selectedTag","listFilter"),m=class extends i.default{constructor(){super(...arguments),_(this,"siteSettings",b,this),_(this,"loading",f,this),_(this,"listFilter",h,this),_(this,"replies",g,this),_(this,"selectedTag",v,this),_(this,"availableTags",y,this)}get filteredReplies(){const e=this.listFilter.toLowerCase()
return this.replies.map((t=>(t.score=0,t.title.toLowerCase().includes(e)?t.score+=2:t.content.toLowerCase().includes(e)&&(t.score+=1),t))).filter((e=>0!==e.score)).filter((e=>this.selectedTag===u.ALL_TAGS_ID||(this.selectedTag===u.NO_TAG_ID&&0===e.tags.length||e.tags.includes(this.selectedTag)))).sort(((e,t)=>e.score!==t.score?e.score>t.score?-1:1:e.title!==t.title?e.title<t.title?-1:1:0))}async load(){try{this.loading=!0
const e=await(0,s.ajax)("/discourse_templates")
this.replies=e.templates,this.siteSettings.tagging_enabled&&(this.availableTags=Object.values(this.replies.reduce(((e,t)=>(t.tags.forEach((t=>{e[t]?e[t].count+=1:e[t]={id:t,name:t,count:1}})),e)),{})))}catch(e){this.loading=!1,(0,n.popupAjaxError)(e)}finally{this.loading=!1,(0,l.schedule)("afterRender",(()=>document.querySelector(".templates-filter")?.focus()))}}changeSelectedTag(e){this.selectedTag=e}insertTemplate(e){this.args.onBeforeInsertTemplate?.(),this.args.onInsertTemplate?.(e),this.args.onAfterInsertTemplate?.()}},b=w(m.prototype,"siteSettings",[a.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f=w(m.prototype,"loading",[r.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),h=w(m.prototype,"listFilter",[r.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),g=w(m.prototype,"replies",[r.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),v=w(m.prototype,"selectedTag",[r.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return u.ALL_TAGS_ID}}),y=w(m.prototype,"availableTags",[r.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),w(m.prototype,"filteredReplies",[d],Object.getOwnPropertyDescriptor(m.prototype,"filteredReplies"),m.prototype),w(m.prototype,"load",[c.bind],Object.getOwnPropertyDescriptor(m.prototype,"load"),m.prototype),w(m.prototype,"changeSelectedTag",[o.action],Object.getOwnPropertyDescriptor(m.prototype,"changeSelectedTag"),m.prototype),w(m.prototype,"insertTemplate",[o.action],Object.getOwnPropertyDescriptor(m.prototype,"insertTemplate"),m.prototype),m);(0,t.setComponentTemplate)(T,O)})),define("discourse/plugins/discourse-templates/discourse/components/d-templates/item-content",["exports","@ember/component","@ember/component/template-only","@ember/template-factory"],(function(e,t,i,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const o=(0,r.createTemplateFactory)({id:"r2J+FHK0",block:'[[[10,0],[14,0,"templates-content"],[12],[1,"\\n  "],[8,[39,0],[[24,0,"template-item-source-link"]],[["@route","@models"],["topic",[28,[37,1],[[30,1,["slug"]],[30,1,["id"]]],null]]],[["default"],[[[[1,"\\n    "],[1,[28,[35,2],["crosshairs"],null]],[1,"\\n    "],[1,[28,[35,3],["templates.source"],null]],[1,"\\n  "]],[]]]]],[1,"\\n  "],[8,[39,4],null,[["@rawText"],[[30,1,["content"]]]],null],[1,"\\n"],[13]],["@template"],false,["link-to","array","d-icon","i18n","cook-text"]]',moduleName:"discourse/plugins/discourse-templates/discourse/components/d-templates/item-content.hbs",isStrictMode:!1})
e.default=(0,t.setComponentTemplate)(o,(0,i.default)())})),define("discourse/plugins/discourse-templates/discourse/components/d-templates/item",["exports","@ember/component","@glimmer/component","@ember/object","discourse/lib/ajax","discourse/lib/ajax-error","@ember/template-factory"],(function(e,t,i,r,o,l,a){"use strict"
var s
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=(0,a.createTemplateFactory)({id:"6/xlvlVX",block:'[[[10,"details"],[14,0,"template-item"],[15,1,[29,["template-item-",[30,1,["id"]]]]],[12],[1,"\\n  "],[10,"summary"],[14,0,"template-item-title"],[12],[1,"\\n    "],[10,0],[14,0,"template-item-title-text"],[12],[1,[30,1,["title"]]],[13],[1,"\\n\\n    "],[10,0],[14,0,"actions"],[12],[1,"\\n      "],[8,[39,0],[[24,0,"templates-apply"]],[["@action","@icon"],[[28,[37,1],[[30,0],"apply"],null],"far-clipboard"]],null],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n\\n  "],[8,[39,2],null,[["@template"],[[30,1]]],null],[1,"\\n"],[13]],["@template"],false,["d-button","action","d-templates/item-content"]]',moduleName:"discourse/plugins/discourse-templates/discourse/components/d-templates/item.hbs",isStrictMode:!1})
let c=e.default=(s=class extends i.default{apply(){this.args.onInsertTemplate?.(this.args.template),(0,o.ajax)(`/discourse_templates/${this.args.template.id}/use`,{type:"POST"}).catch(l.popupAjaxError)}},u=s.prototype,p="apply",d=[r.action],m=Object.getOwnPropertyDescriptor(s.prototype,"apply"),b=s.prototype,f={},Object.keys(m).forEach((function(e){f[e]=m[e]})),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=d.slice().reverse().reduce((function(e,t){return t(u,p,e)||e}),f),b&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(b):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(u,p,f),f=null),s)
var u,p,d,m,b,f;(0,t.setComponentTemplate)(n,c)})),define("discourse/plugins/discourse-templates/discourse/components/d-templates/modal/form",["exports","@ember/component","@glimmer/component","@ember/service","@ember/template-factory"],(function(e,t,i,r,o){"use strict"
var l,a
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const s=(0,o.createTemplateFactory)({id:"StqqkQ0S",block:'[[[8,[39,0],[[24,0,"d-templates d-templates-modal"]],[["@closeModal","@title"],[[30,1],[28,[37,1],["templates.insert_template"],null]]],[["body"],[[[[1,"\\n    "],[8,[39,2],null,[["@textarea","@onInsertTemplate","@onAfterInsertTemplate"],[[30,2,["textarea"]],[30,2,["onInsertTemplate"]],[30,1]]],null],[1,"\\n  "]],[]]]]]],["@closeModal","@model"],false,["d-modal","i18n","d-templates/filterable-list"]]',moduleName:"discourse/plugins/discourse-templates/discourse/components/d-templates/modal/form.hbs",isStrictMode:!1})
let n=e.default=(l=class extends i.default{constructor(){var e,t,i,r
super(...arguments),e=this,t="appEvents",r=this,(i=a)&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0}),this.args.closeModal&&this.appEvents.on("page:changed",this,this.args.closeModal)}willDestroy(){super.willDestroy(...arguments),this.args.closeModal&&this.appEvents.off("page:changed",this,this.args.closeModal)}},c=l.prototype,u="appEvents",p=[r.service],d={configurable:!0,enumerable:!0,writable:!0,initializer:null},b={},Object.keys(d).forEach((function(e){b[e]=d[e]})),b.enumerable=!!b.enumerable,b.configurable=!!b.configurable,("value"in b||b.initializer)&&(b.writable=!0),b=p.slice().reverse().reduce((function(e,t){return t(c,u,e)||e}),b),m&&void 0!==b.initializer&&(b.value=b.initializer?b.initializer.call(m):void 0,b.initializer=void 0),void 0===b.initializer&&(Object.defineProperty(c,u,b),b=null),a=b,l)
var c,u,p,d,m,b;(0,t.setComponentTemplate)(s,n)})),define("discourse/plugins/discourse-templates/discourse/components/d-templates/tag-drop",["exports","@ember/object","select-kit/components/tag-drop"],(function(e,t,i){"use strict"
var r,o
function l(e,t,i,r,o){var l={}
return Object.keys(r).forEach((function(e){l[e]=r[e]})),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=i.slice().reverse().reduce((function(i,r){return r(e,t,i)||i}),l),o&&void 0!==l.initializer&&(l.value=l.initializer?l.initializer.call(o):void 0,l.initializer=void 0),void 0===l.initializer&&(Object.defineProperty(e,t,l),l=null),l}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(r=(0,t.computed)("availableTags.[]"),l((o=class extends i.default{get topTags(){return(this.availableTags||[]).sort(((e,t)=>e.count!==t.count?t.count-e.count:e.name!==t.name?e.name<t.name?-1:1:0))}search(e){return(this.content||[]).map((e=>e.id&&e.name?e:this.defaultItem(e,e))).filter((t=>{if(null==e)return!0
const i=e.toLowerCase()
return t.id.toLowerCase().includes(i)||t.name.toLowerCase().includes(i)}))}onChange(e,t){this.onChangeSelectedTag?.(e,t)}}).prototype,"topTags",[r],Object.getOwnPropertyDescriptor(o.prototype,"topTags"),o.prototype),l(o.prototype,"onChange",[t.action],Object.getOwnPropertyDescriptor(o.prototype,"onChange"),o.prototype),o)})),define("discourse/plugins/discourse-templates/discourse/connectors/below-footer/d-templates-modal-container",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-templates/discourse/components/d-templates/modal/form","@ember/template-factory","@ember/component"],(function(e,t,i,r,o,l){"use strict"
var a,s,n
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(n=class extends t.default{constructor(){var e,t,i,r
super(...arguments),e=this,t="dTemplatesModal",r=this,(i=s)&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}},(0,l.setComponentTemplate)((0,o.createTemplateFactory)({id:"9ouJ2oOR",block:'[[[1,"\\n"],[41,[30,0,["dTemplatesModal","model"]],[[[1,"      "],[10,0],[14,0,"modal-container d-templates-modal-container"],[12],[1,"\\n        "],[8,[32,0],null,[["@closeModal","@model"],[[30,0,["dTemplatesModal","hide"]],[30,0,["dTemplatesModal","model"]]]],null],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-templates/discourse/connectors/below-footer/d-templates-modal-container.js",scope:()=>[r.default],isStrictMode:!0}),n),c=(a=n).prototype,u="dTemplatesModal",p=[i.inject],d={configurable:!0,enumerable:!0,writable:!0,initializer:null},b={},Object.keys(d).forEach((function(e){b[e]=d[e]})),b.enumerable=!!b.enumerable,b.configurable=!!b.configurable,("value"in b||b.initializer)&&(b.writable=!0),b=p.slice().reverse().reduce((function(e,t){return t(c,u,e)||e}),b),m&&void 0!==b.initializer&&(b.value=b.initializer?b.initializer.call(m):void 0,b.initializer=void 0),void 0===b.initializer&&(Object.defineProperty(c,u,b),b=null),s=b,a)
var c,u,p,d,m,b})),define("discourse/plugins/discourse-templates/discourse/connectors/editor-preview/d-templates",["exports","@ember/object","discourse-common/lib/get-owner"],(function(e,t,i){"use strict"
var r
function o(e,t,i,r,o){var l={}
return Object.keys(r).forEach((function(e){l[e]=r[e]})),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=i.slice().reverse().reduce((function(i,r){return r(e,t,i)||i}),l),o&&void 0!==l.initializer&&(l.value=l.initializer?l.initializer.call(o):void 0,l.initializer=void 0),void 0===l.initializer&&(Object.defineProperty(e,t,l),l=null),l}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const l="#reply-control .d-editor-preview-wrapper > .d-editor-preview"
e.default=(o(r={setupComponent(e,t){t.setProperties({templatesVisible:!1,model:(0,i.getOwnerWithFallback)(this).lookup("controller:composer").model}),this.appEvents.on("discourse-templates:show",this,"show"),this.appEvents.on("discourse-templates:hide",this,"hide")},teardownComponent(){this.appEvents.off("discourse-templates:show",this,"show"),this.appEvents.off("discourse-templates:hide",this,"hide")},shouldRender:(e,t)=>!t.site.mobileView,show(e){let{onInsertTemplate:t}=e
const i=document.querySelector(l)
i&&(i.style.display="none"),this.set("onInsertTemplate",t),this.set("templatesVisible",!0)},hide(){const e=document.querySelector(l)
e&&(e.style.display=""),this.set("templatesVisible",!1)}},"show",[t.action],Object.getOwnPropertyDescriptor(r,"show"),r),o(r,"hide",[t.action],Object.getOwnPropertyDescriptor(r,"hide"),r),r)})),define("discourse/plugins/discourse-templates/discourse/connectors/topic-above-posts/discourse-templates-button",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","discourse/lib/ajax","discourse-common/lib/debounce"],(function(e,t,i,r,o,l,a){"use strict"
var s,n,c
function u(e,t,i,r){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function p(e,t,i,r,o){var l={}
return Object.keys(r).forEach((function(e){l[e]=r[e]})),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=i.slice().reverse().reduce((function(i,r){return r(e,t,i)||i}),l),o&&void 0!==l.initializer&&(l.value=l.initializer?l.initializer.call(o):void 0,l.initializer=void 0),void 0===l.initializer&&(Object.defineProperty(e,t,l),l=null),l}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(s=class extends t.default{constructor(){super(...arguments),u(this,"composer",n,this),u(this,"copyConfirm",c,this)}static shouldRender(e,t){return e.model.is_template&&t.currentUser?.can_create_topic}async fetchRaw(){const e=this.args.outletArgs.model
return await(0,l.ajax)(`/raw/${e.id}/1`,{dataType:"text"})}async createNewTopic(){const e=await this.fetchRaw()
this.composer.openNewTopic({body:e})}async copy(){const e=await this.fetchRaw()
navigator.clipboard.writeText(e),this.copyConfirm=!0,(0,a.default)(this.resetCopyButton,2e3)}resetCopyButton(){this.copyConfirm=!1}},n=p(s.prototype,"composer",[o.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c=p(s.prototype,"copyConfirm",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),p(s.prototype,"createNewTopic",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"createNewTopic"),s.prototype),p(s.prototype,"copy",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"copy"),s.prototype),p(s.prototype,"resetCopyButton",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"resetCopyButton"),s.prototype),s)})),define("discourse/plugins/discourse-templates/discourse/initializers/d-templates",["exports","discourse/lib/keyboard-shortcuts","discourse/lib/plugin-api","discourse-common/lib/get-owner","discourse/plugins/discourse-templates/lib/variables-chat-channel","discourse/plugins/discourse-templates/lib/variables-chat-thread"],(function(e,t,i,r,o,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"discourse-templates-add-ui-builder",initialize(e){const s=e.lookup("service:site-settings"),n=e.lookup("service:current-user")
s.discourse_templates_enabled&&n?.can_use_templates&&(0,i.withPluginApi)("1.13.0",(i=>{(function(e){const t=e.container.lookup("service:d-templates")
e.addComposerToolbarPopupMenuOption({icon:"far-clipboard",label:"templates.insert_template",action:()=>{t.showComposerUI()}})})(i),function(e,i){e.addKeyboardShortcut(`${t.PLATFORM_KEY_MODIFIER}+shift+i`,(e=>{e.preventDefault()
const t=i.lookup("service:d-templates")
if(t.isComposerFocused)t.showComposerUI()
else{for(const e of a)if(t.isTextAreaFocused&&e?.isFocused?.(document.activeElement))return void t.showTextAreaUI(e?.variables)
t.isTextAreaFocused&&t.showTextAreaUI()}}),{global:!0,help:{category:"templates",name:"templates.insert_template",definition:{keys1:[t.PLATFORM_KEY_MODIFIER,"shift","I"],keysDelimiter:"plus"}}})}(i,e),function(e,t){if(!t.lookup("service:chat")?.userCanChat)return
const i=function(){const e=(0,r.getOwnerWithFallback)(this).lookup("service:chat"),t=e?.activeChannel,i=t?.draft,l=(0,r.getOwnerWithFallback)(this).lookup("service:router")
return(0,o.default)(t,i,l)},s=function(){const e=(0,r.getOwnerWithFallback)(this).lookup("service:chat"),t=e?.activeChannel?.activeThread,i=t?.draft,o=(0,r.getOwnerWithFallback)(this).lookup("service:router")
return(0,l.default)(t,i,o)}
e.registerChatComposerButton({id:"d-templates-chat-insert-template-btn",icon:"far-clipboard",label:"templates.insert_template",position:"dropdown",action:function(){let e
switch(this.context){case"channel":e=i.bind(this)
break
case"thread":e=s.bind(this)
break
default:e=null}const t=this.composer?.textarea?.textarea;(0,r.getOwnerWithFallback)(this).lookup("service:d-templates").showTextAreaUI(e,t)},displayed(){return this.composer?.textarea&&("channel"===this.context||"thread"===this.context)}}),a.push({isFocused:e=>"channel-composer"===e?.id,variables:i},{isFocused:e=>"thread-composer"===e?.id,variables:s})}(i,e)}))}}
const a=[]})),define("discourse/plugins/discourse-templates/discourse/services/d-templates-modal",["exports","@glimmer/tracking","@ember/object","@ember/service"],(function(e,t,i,r){"use strict"
var o,l
function a(e,t,i,r,o){var l={}
return Object.keys(r).forEach((function(e){l[e]=r[e]})),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=i.slice().reverse().reduce((function(i,r){return r(e,t,i)||i}),l),o&&void 0!==l.initializer&&(l.value=l.initializer?l.initializer.call(o):void 0,l.initializer=void 0),void 0===l.initializer&&(Object.defineProperty(e,t,l),l=null),l}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(o=class extends r.default{constructor(){var e,t,i,r
super(...arguments),e=this,t="model",r=this,(i=l)&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}show(e){this.model=e}hide(){this.model?.textarea?.focus(),this.model=null}},l=a(o.prototype,"model",[t.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),a(o.prototype,"show",[i.action],Object.getOwnPropertyDescriptor(o.prototype,"show"),o.prototype),a(o.prototype,"hide",[i.action],Object.getOwnPropertyDescriptor(o.prototype,"hide"),o.prototype),o)})),define("discourse/plugins/discourse-templates/discourse/services/d-templates",["exports","@ember/application","@ember/service","discourse/plugins/discourse-templates/lib/replace-variables","discourse/plugins/discourse-templates/lib/textarea-manipulator","discourse/plugins/discourse-templates/lib/variables-composer"],(function(e,t,i,r,o,l){"use strict"
var a,s,n,c,u,p,d,m,b,f,h,g,v
function y(e,t,i,r){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function _(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function w(e,t,i){return function(e,t,i){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:i
throw new TypeError("Private element is not present on this object")}(t,e),i}function T(e,t,i,r,o){var l={}
return Object.keys(r).forEach((function(e){l[e]=r[e]})),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=i.slice().reverse().reduce((function(i,r){return r(e,t,i)||i}),l),o&&void 0!==l.initializer&&(l.value=l.initializer?l.initializer.call(o):void 0,l.initializer=void 0),void 0===l.initializer&&(Object.defineProperty(e,t,l),l=null),l}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(d=new WeakSet,m=new WeakSet,b=new WeakSet,f=new WeakSet,h=new WeakSet,g=new WeakSet,v=new WeakSet,a=class extends i.default{constructor(){super(...arguments),_(this,v),_(this,g),_(this,h),_(this,f),_(this,b),_(this,m),_(this,d),y(this,"appEvents",s,this),y(this,"modal",n,this),y(this,"site",c,this),y(this,"currentUser",u,this),y(this,"dTemplatesModal",p,this)}showComposerUI(){const e=w(this,g,k).bind(this)
this.site.mobileView?w(this,b,j).call(this,null,e):w(this,f,z).call(this,e)}showTextAreaUI(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.activeElement
if(!w(this,d,O).call(this,t))return
const i=document.querySelector(".d-modal"),r=w(this,h,x).bind(this),o=t=>e?.(t)
i?.contains(t)?i.classList.contains("d-templates")||w(this,b,j).call(this,t,(e=>{const i=this.modal.activeModal?.opts?.model
r(t,e,o(i))})):w(this,b,j).call(this,t,(e=>r(t,e,o())))}get isComposerFocused(){const e=document.activeElement,i=(0,t.getOwner)(this).lookup("controller:composer").model,r=document.querySelector(".d-editor")
return i&&r?.contains(e)}get isTextAreaFocused(){return w(this,d,O).call(this,document.activeElement)}},s=T(a.prototype,"appEvents",[i.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n=T(a.prototype,"modal",[i.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c=T(a.prototype,"site",[i.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u=T(a.prototype,"currentUser",[i.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p=T(a.prototype,"dTemplatesModal",[i.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a)
function O(e){return"TEXTAREA"===e?.nodeName}function j(e,t){this.dTemplatesModal.show({textarea:e,onInsertTemplate:t})}function z(e){this.appEvents.trigger("composer-messages:close"),this.appEvents.trigger("composer:show-preview"),this.appEvents.trigger("discourse-templates:show",{onInsertTemplate:e})}function x(e,i,r){i=w(this,v,P).call(this,i.title,i.content,r),new o.default((0,t.getOwner)(this),e).addBlock(i.content)}function k(e){const i=(0,t.getOwner)(this).lookup("controller:composer").model,r=(0,l.default)(i)
e=w(this,v,P).call(this,e.title,e.content,r),i&&!i.title&&i.set("title",e.title),this.appEvents.trigger("composer:insert-block",e.content)}function P(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}
return(0,r.replaceVariables)(e,t,{...i,my_username:this.currentUser?.username,my_name:this.currentUser?.displayName})}})),define("discourse/plugins/discourse-templates/discourse/templates/connectors/editor-preview/d-templates",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"IBGlp3aJ",block:'[[[41,[30,0,["templatesVisible"]],[[[1,"  "],[10,0],[14,0,"d-templates-container"],[12],[1,"\\n    "],[8,[39,1],[[24,0,"modal-close close btn-flat"]],[["@action","@icon"],[[28,[37,2],[[30,0],"hide"],null],"times"]],null],[1,"\\n    "],[8,[39,3],null,[["@onInsertTemplate","@onAfterInsertTemplate"],[[30,0,["onInsertTemplate"]],[28,[37,2],[[30,0],"hide"],null]]],null],[1,"\\n  "],[13],[1,"\\n"]],[]],null]],[],false,["if","d-button","action","d-templates/filterable-list"]]',moduleName:"discourse/plugins/discourse-templates/discourse/templates/connectors/editor-preview/d-templates.hbs",isStrictMode:!1})})),define("discourse/plugins/discourse-templates/discourse/templates/connectors/topic-above-posts/discourse-templates-button",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"JxzWUf6/",block:'[[[10,0],[14,0,"template-topic-controls"],[12],[1,"\\n  "],[8,[39,0],[[16,0,[28,[37,1],["btn-default","template-copy",[52,[30,0,["copyConfirm"]],"ok"]],null]]],[["@icon","@action","@label"],[[52,[30,0,["copyConfirm"]],"check","copy"],[30,0,["copy"]],"templates.copy"]],null],[1,"\\n  "],[8,[39,0],[[24,0,"template-new-topic"]],[["@action","@label","@icon"],[[30,0,["createNewTopic"]],"templates.new_topic","plus"]],null],[1,"\\n"],[13]],[],false,["d-button","concat-class","if"]]',moduleName:"discourse/plugins/discourse-templates/discourse/templates/connectors/topic-above-posts/discourse-templates-button.hbs",isStrictMode:!1})})),define("discourse/plugins/discourse-templates/lib/replace-variables",["exports","discourse/models/user"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.TEMPLATES_ALLOWED_VARIABLES=void 0,e.replaceVariables=function(e,r,o){const l=t.default.current(),a={...o||{},my_username:l?.username,my_name:l?.displayName}
if(a&&"object"==typeof a)for(const t of i)a[t]?(e=e.replace(new RegExp(`%{${t}(,fallback:.[^}]*)?}`,"g"),a[t]),r=r.replace(new RegExp(`%{${t}(,fallback:.[^}]*)?}`,"g"),a[t])):(e=(e=e.replace(new RegExp(`%{${t},fallback:(.[^}]*)}`,"g"),"$1")).replace(new RegExp(`%{${t}}`,"g"),""),r=(r=r.replace(new RegExp(`%{${t},fallback:(.[^}]*)}`,"g"),"$1")).replace(new RegExp(`%{${t}}`,"g"),""))
return{title:e,content:r}}
const i=e.TEMPLATES_ALLOWED_VARIABLES=Object.freeze(["my_username","my_name","chat_channel_name","chat_channel_url","chat_thread_name","chat_thread_url","context_title","context_url","topic_title","topic_url","original_poster_username","original_poster_name","reply_to_username","reply_to_name","last_poster_username","reply_to_or_last_poster_username"])})),define("discourse/plugins/discourse-templates/lib/textarea-manipulator",["exports","@ember/application","@ember/object","discourse/mixins/textarea-text-manipulation"],(function(e,t,i,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends(i.default.extend(r.default)){constructor(e,i){super(...arguments),(0,t.setOwner)(this,e),this._textarea=i,this.element=this._textarea,this.ready=!0,this.init()}addBlock(e){this._addBlock(this.getSelected(),e)}}e.default=o})),define("discourse/plugins/discourse-templates/lib/variables-chat-channel",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,t,i){if(!e&&!t)return{}
const r=t?.inReplyTo,o={chat_channel_name:e?.title,chat_channel_url:e?.routeModels?i?.urlFor("chat.channel",...e.routeModels):null,reply_to_username:r?.user?.username,reply_to_name:r?.user?.name}
return{...o,context_title:o.chat_channel_name,context_url:o.chat_channel_url}}})),define("discourse/plugins/discourse-templates/lib/variables-chat-thread",["exports","discourse/plugins/discourse-templates/lib/variables-chat-channel"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,i,r){if(!e&&!i)return{}
const o=e?.channel,l=e?.originalMessage,a=(0,t.default)(o,i,r),s={chat_thread_name:e?.title,chat_thread_url:e?.routeModels?r?.urlFor("chat.channel.thread",...e.routeModels):null,reply_to_username:l?.user?.username,reply_to_name:l?.user?.name}
return{...a,...s,context_title:s.chat_thread_name||a.chat_channel_name,context_url:s.chat_thread_url||a.chat_channel_url}}})),define("discourse/plugins/discourse-templates/lib/variables-composer",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e){if(!e)return{}
const t={topic_title:e.topic?.title,topic_url:e.topic?.url,original_poster_username:e.topic?.details.created_by.username,original_poster_name:e.topic?.details.created_by.name,reply_to_username:e.post?.username,reply_to_name:e.post?.name,last_poster_username:e.topic?.last_poster_username,reply_to_or_last_poster_username:e.post?.username||e.topic?.last_poster_username}
return{...t,context_title:t.topic_title,context_url:t.topic_url}}}))

//# sourceMappingURL=discourse-templates-0e82afc626e90ecceea272eee4032522ead90876a5d996e50381a30e8a53f804.map
//!

;
